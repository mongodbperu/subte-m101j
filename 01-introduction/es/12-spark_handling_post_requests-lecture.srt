1
00:00:00,000 --> 00:00:00,260

2
00:00:00,260 --> 00:00:04,170
En el último vídeo vimos
cómo usar Spark para definir

3
00:00:04,170 --> 00:00:06,900
varias rutas para peticiones
GET, incluyendo comodines,

4
00:00:06,900 --> 00:00:10,070
y en este vídeo,
vamos a examinar cómo

5
00:00:10,070 --> 00:00:12,670
usar Spark para manejar
contenidos de formularios.

6
00:00:12,670 --> 00:00:15,580
Como probablemente sabes, los
formularios normalmente se tratan

7
00:00:15,580 --> 00:00:18,140
con peticiones HTTP POST.

8
00:00:18,140 --> 00:00:20,240
Echemos un vistazo a un formulario.

9
00:00:20,240 --> 00:00:22,380
Ya he creado una aplicación
y la tengo en ejecución en

10
00:00:22,380 --> 00:00:26,790
el puerto 4567, el puerto por
defecto de Spark, y es

11
00:00:26,790 --> 00:00:27,930
un formulario muy simple.

12
00:00:27,930 --> 00:00:30,490
La página de inicio presenta un
conjunto de botones de opción,

13
00:00:30,490 --> 00:00:32,090
que te permiten elegir tu
fruta favorita.

14
00:00:32,090 --> 00:00:34,912
Las cuatro opciones son "apple",
"orange", "banana" y

15
00:00:34,912 --> 00:00:36,730
"peach", y entonces
puedes enviar el formulario.

16
00:00:36,730 --> 00:00:39,600
La forma en que la aplicación
funciona, si envías sin

17
00:00:39,600 --> 00:00:41,890
seleccionar nada, dice
"Why don't you pick one?".

18
00:00:41,890 --> 00:00:44,740
En caso contrario,
si eliges una,

19
00:00:44,740 --> 00:00:45,620
te la devolverá:

20
00:00:45,620 --> 00:00:48,120
"Your favorite fruit is orange".

21
00:00:48,120 --> 00:00:50,230
Y esa es la aplicación.

22
00:00:50,230 --> 00:00:52,410
Ahora, echemos un vistazo
al código.

23
00:00:52,410 --> 00:00:54,880
Examinemos primero
la plantilla.

24
00:00:54,880 --> 00:00:57,950
Esta es la plantilla de Freemarker
y tiene como título

25
00:00:57,950 --> 00:01:01,740
"Fruit Picker" y un
formulario sencillo.

26
00:01:01,740 --> 00:01:05,319
Las piezas clave a notar aquí
son el "action" del formulario,

27
00:01:05,319 --> 00:01:09,230
"/favorite_fruit" es el "action"
del formulario, por lo que va a

28
00:01:09,230 --> 00:01:12,970
enviar una petición POST a la
URI "/favorite_fruit".

29
00:01:12,970 --> 00:01:15,960
El método será POST,
y pregunta cuál es

30
00:01:15,960 --> 00:01:20,200
tu fruta favorita e
itera por un array

31
00:01:20,200 --> 00:01:21,890
llamado "fruits".

32
00:01:21,890 --> 00:01:24,360
Y como eso no está definido
en este formulario, vamos a

33
00:01:24,360 --> 00:01:27,580
tener que pasarlo en el
mapa que usemos cuando

34
00:01:27,580 --> 00:01:29,260
procese esta plantilla.

35
00:01:29,260 --> 00:01:33,910
Entonces, por cada fruta en
esta lista de frutas,

36
00:01:33,910 --> 00:01:38,070
crearemos un botón de opción con
nombre igual a "fruit" y valor

37
00:01:38,070 --> 00:01:42,050
igual a "${fruit}", y esto es
un valor de Freemarker.

38
00:01:42,050 --> 00:01:44,980
Consiste en signo de dólar, llave
inicial, "fruit", y llave final.

39
00:01:44,980 --> 00:01:48,980
Esta variable "fruit" tomará
un nuevo valor por cada

40
00:01:48,980 --> 00:01:51,310
iteración del bucle.

41
00:01:51,310 --> 00:01:53,625
Entonces tenemos esta lista de
frutas, y la primera vez será

42
00:01:53,625 --> 00:01:54,320
la primera fruta.

43
00:01:54,320 --> 00:01:57,960
La segunda vez, terminaremos con,
como vimos antes, cuatro

44
00:01:57,960 --> 00:01:59,730
botones de opción, uno
por cada fruta.

45
00:01:59,730 --> 00:02:02,570
Y por último, enviamos
el formulario usando

46
00:02:02,570 --> 00:02:04,640
"input type='submit'".

47
00:02:04,640 --> 00:02:07,710
Echemos un vistazo al
código java.

48
00:02:07,710 --> 00:02:11,430
En el código java comenzamos
con nuestra configuración

49
00:02:11,430 --> 00:02:13,070
de Freemarker, aquí arriba.

50
00:02:13,070 --> 00:02:16,300
Creamos una nueva
configuración,

51
00:02:16,300 --> 00:02:17,100
y definimos nuestras rutas.

52
00:02:17,100 --> 00:02:20,270
Tenemos una ruta para las
peticiones GET, la cual

53
00:02:20,270 --> 00:02:22,620
presenta esta forma, "/".

54
00:02:22,620 --> 00:02:25,320
Aquí es donde creamos el
mapa que vamos a pasar

55
00:02:25,320 --> 00:02:26,650
a esta plantilla.

56
00:02:26,650 --> 00:02:31,170
Tiene una única clave en el mapa,
llamada "fruits", cuyo valor

57
00:02:31,170 --> 00:02:34,660
es la lista de frutas
que vimos antes,

58
00:02:34,660 --> 00:02:37,950
"apple", "orange", "banana",
y "peach".

59
00:02:37,950 --> 00:02:40,860
Lo siguiente que hacemos es recuperar
la plantilla de la configuración de

60
00:02:40,860 --> 00:02:42,330
Freemarker.

61
00:02:42,330 --> 00:02:44,100
Se llama "fruitPicker.ftl".

62
00:02:44,100 --> 00:02:46,580
Ese es el nombre
del fichero aquí.

63
00:02:46,580 --> 00:02:49,910
Así que obtenemos la plantilla,
creamos un "StringWriter" en el

64
00:02:49,910 --> 00:02:52,680
que procesar la plantilla,
y por último la procesamos,

65
00:02:52,680 --> 00:02:56,540
pasando el mapa
y el objeto "writer".

66
00:02:56,540 --> 00:03:00,400
A continuación devolvemos el
objeto "writer" a Spark.

67
00:03:00,400 --> 00:03:03,550
Eso es lo que presenta al usuario
el formulario que vimos antes,

68
00:03:03,550 --> 00:03:05,870
y esta es la parte nueva.

69
00:03:05,870 --> 00:03:09,310
Este es el trozo que maneja el
formulario cuando es enviado.

70
00:03:09,310 --> 00:03:13,180
La última ruta era para una petición
GET, pero esta es POST, ya que

71
00:03:13,180 --> 00:03:15,320
estamos enviando contenidos
al sitio web.

72
00:03:15,320 --> 00:03:18,870
Por lo tanto ponemos "Spark.post"
y como ruta "/favorite_fruit",

73
00:03:18,870 --> 00:03:22,355
que concuerda con el valor
del "action" del formulario,

74
00:03:22,355 --> 00:03:23,790
como vemos aquí.

75
00:03:23,790 --> 00:03:27,290
Y el método "handle" obtiene
el parámetro llamado "fruit",

76
00:03:27,290 --> 00:03:29,490
que era el nombre del
parámetro que definimos

77
00:03:29,490 --> 00:03:30,920
en los botones de opción.

78
00:03:30,920 --> 00:03:33,660
Recuperamos el valor, y si
no existe, devolvemos

79
00:03:33,660 --> 00:03:34,780
"Why don't you pick one?"

80
00:03:34,780 --> 00:03:37,240
En caso contrario, devolvemos
"Your favorite fruit is" y

81
00:03:37,240 --> 00:03:38,740
lo que sea que seleccionaras.

82
00:03:38,740 --> 00:03:41,660
Podríamos haber usado aquí una
plantilla de Freemarker, de hecho,

83
00:03:41,660 --> 00:03:43,820
en una aplicación real,
usaríamos una plantilla de

84
00:03:43,820 --> 00:03:44,700
Freemarker para todo.

85
00:03:44,700 --> 00:03:47,970
Pero sólo por mantener el ejemplo
sencillo, en este caso decidí

86
00:03:47,970 --> 00:03:52,170
devolver simplemente una cadena
de texto en este manejador particular.

87
00:03:52,170 --> 00:03:55,740
Volvamos y echemos un vistazo
a la aplicación una vez más.

88
00:03:55,740 --> 00:03:59,120
Seleccionamos "banana" y
lo enviamos.

89
00:03:59,120 --> 00:04:01,590
"Your favorite fruit is banana",
y en eso consiste

90
00:04:01,590 --> 00:04:02,840
la aplicación.

91
00:04:02,840 --> 00:04:03,140
